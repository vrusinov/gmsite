Monit - достаточно простое, но одновременно удобное, достаточно мощное и надежное средство для мониторинга ваших серверов.<br>Monit умеет мониторить:<br><ul><li>процессы (наличие, количество потребляемых ресурсов)</li><li>файлы, директории и файловые системы на изменения (дата создания/изменения, изменения размера и контрольной суммы)</li><li>сетевые хосты (пинг и коннект на определенный порт по определенному протоколу)</li></ul>При возникновении проблемы monit отправляет e-mail (шаблоны можно модифицировать) и может перезапустить сервис.<br>В monit встроен простенький веб-сервер, который позволяет посмотреть состояние объектов мониторинга, включить/выключить определенный объект.<br>Monit умеет перезапускать сервисы если они падают или не выполняется какое-то условие.<br><br>Monit построен с идеей того что система мониторинга должна быть максимально надежной и простой. И это действительно выполняется: на monit можно положиться.

Конечно из-за своей простоты monit не обладает тем количеством возможностей, которыми обладают Enterptise-системы мониторинга. Однако существует дополнение к monit под названием M/Monit, которое позволяет управлять несколькими серверами с monit из одного места. К сожалению, M/Monit распространяется под коммерческой лицензией и за деньги.<br><br>Посмотрим что он умеет:<br><br>Установка проста:

```shell
emerge -av monit
```

После этого вам необходимо отредактировать файл `/etc/monitrc`. Он достаточно хорошо документирован и там много примеров, вот еще несколько:<br><br>/etc/monitrc<br><pre class="brush: bash">set daemon  120 # проверять объекты каждые 2 минуты<br>set logfile syslog facility log_daemon<br><br>set mailserver localhost # тут для большей надежности можно указать несколько smtp-серверов<br>set eventqueue # задаем очередь сообщений - чтобы monit мог отправить алерт позже, если в данный момент почтовый сервер не доступен<br>    basedir /var/monit<br>    slots 10<br>set mail-format { from: monit@ myserver.com }<br>set alert admin1 admin2 # список получателей алертов<br><br># конфигурация встроенного http сервера<br>set httpd port 2812 and<br>    use address 0.0.0.0<br>    allow 1.2.3.4<br>    allow admin:password<br><br>include /etc/monit.d/*<br></pre><br>/etc/monit.d/system<br><pre class="brush: bash"># проверка общих ресурсов сервера<br>check system myserver<br>    if loadavg (1min) &gt; 30 then alert<br>    if loadavg (5min) &gt; 20 then alert<br>    if memory usage &gt; 75% then alert<br>   if cpu usage (user) &gt; 70% then alert<br></pre><br><pre class="brush: bash"># проверка apache2:<br>check process apache with pidfile /var/run/apache2.pid<br>    start program = "/etc/init.d/apache2 start"<br>    stop program  = "/etc/init.d/apache2 stop"<br>    if totalmem &gt; 500.0 MB for 5 cycles then restart<br>    if children &gt; 250 then restart<br>    if loadavg(5min) greater than 30 for 8 cycles then stop<br>    if failed host myserver.com port 80 protocol http<br>       and request "/index.html"<br>       then restart<br>    if failed port 443 type tcpssl protocol http<br>       with timeout 15 seconds<br>       then restart<br>    if 3 restarts within 5 cycles then timeout<br></pre><br><br><pre class="brush: bash"># проверка свободного места на фс<br>check device data with path /dev/sdb1<br>    start program  = "/bin/mount /data"<br>    stop program  = "/bin/umount /data"<br>    if space usage &gt; 80% for 5 times within 15 cycles then alert<br>    if inode usage &gt; 80% then alert<br>    group server<br></pre><br>Ссылки:<br><br><ul><li><a href="http://mmonit.com/monit/">Официальный сайт monit</a></li><li><a href="http://mmonit.com/">M/Monit</a></li><li><a href="http://www.lissyara.su/?id=1268">Установка monit на freebsd</a></li></ul>
