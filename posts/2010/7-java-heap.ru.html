<html><body><div dir="ltr" style="text-align: left;">Оригинал: "<a href="http://javahowto.blogspot.com/2006/06/6-common-errors-in-setting-java-heap.html">6 Common Errors in Setting Java Heap Size</a>" (кажется, автор несколько ошибся в подсчетах)<br>Перевод: <a href="http://greenmice.info/ru/node/143">Владимир Русинов</a><br><br>Для установки размера кучи java (heap) используются две опции: -Xmx для установки максимального размера и -Xms для начального(минимального) размера. Вот наиболее часто встречающиеся ошибки их использования:<br><br>1. <b>Отсутствие m, M, g или G в конце (регистр не имеет значения).</b> Например:<br><br><pre class="brush: bash">java -Xmx128 BigApp<br>java.lang.OutOfMemoryError: Java heap space<br></pre><br>Правильная команда должна быть такой: <br><pre class="brush: bash">java -Xmx128m BigApp</pre>. Строго говоря, -Xmx128 корректная настройка для очень маленьких приложений (например HelloWorld), но я думаю в большинстве случаев все-таки имелось в виду -Xmx128m.<br><a name="more"></a><br><br>2. <b>Лишний пробел или использование =.</b> Например:<br><br><pre class="brush: bash">java -Xmx 128m BigApp<br>Invalid maximum heap size: -Xmx<br>Could not create the Java virtual machine.<br></pre><br><pre class="brush: bash">java -Xmx=512m HelloWorld<br>Invalid maximum heap size: -Xmx=512m<br>Could not create the Java virtual machine.<br></pre><br>Правильная команда должна иметь вид <br><pre class="brush: bash">java -Xmx128m BigApp</pre>, без пробела или знака =. -X опции ведут себя отлично от -Dключ=значение опций, в которых используется =.<br><br>3. <b>Установка только -Xms в значение большее чем максимальный размер кучи по умолчанию (64m).</b> Похоже что минимальный размер кучи по умолчанию равен 0.<br>Пример:<br><pre class="brush: bash">java -Xms128m BigApp<br>Error occurred during initialization of VM<br>Incompatible initial and maximum heap sizes specified<br></pre><br>Корректная команда должна выглядеть так: <br><pre class="brush: bash">java -Xms128m -Xmx128m BigApp</pre>. Установить минимальный и максимальный размер равными - хорошая идея. В любом случае, минимальное значение не должно превышать максимальное.<br><br>4. <b>Установка размера кучи большего чем объем доступной физической памяти.</b> Пример:<br><pre class="brush: bash">java -Xmx2g BigApp<br>Error occurred during initialization of VM<br>Could not reserve enough space for object heap<br>Could not create the Java virtual machine.<br></pre><br>Устанавливайте размер кучи меньше чем размер физической памяти: <br><pre class="brush: bash">java -Xmx1g BigApp</pre><br>5. <b>Использование mb в качестве единицы измерения, вместо m или M.</b><br><pre class="brush: bash">java -Xms256mb -Xmx256mb BigApp<br>Invalid initial heap size: -Xms256mb<br>Could not create the Java virtual machine.<br></pre><br>6. <b>Установка размера кучи в большее значение, чем позволяет JVM.</b> Пример:<br><pre class="brush: bash">java -Xmx256g BigApp<br>Invalid maximum heap size: -Xmx256g<br>The specified size exceeds the maximum representable size.<br>Could not create the Java virtual machine.<br></pre><br>Укажите размер поменьше: <br><pre class="brush: bash">java -Xmx256m BigApp</pre><br>7. <b>Указание дробного чиста в качестве значения</b>. Пример:<br><pre class="brush: bash">java -Xmx0.9g BigApp<br>Invalid maximum heap size: -Xmx0.9g<br>Could not create the Java virtual machine.<br></pre><br>Правильная команда должна выглядеть так:<br><pre class="brush: bash">java -Xmx928m BigApp</pre><br><b>PS:</b><br><br><b>Как установить размер кучи(heap) в Tomcat?</b><br><br>Остановите сервер Tomcat, установите переменную окружения CATALINA_OPTS, затем запустите Tomcat снова. Смотрите файлы tomcat-install/bin/catalina.sh или catalina.bat чтобы узнать как используется эта переменная окружения.<br><br>Примеры:<br><pre class="brush: bash">set CATALINA_OPTS=-Xms512m -Xmx512m</pre>(Windows, значение не в кавычках)<br><pre class="brush: bash">export CATALINA_OPTS="-Xms512m -Xmx512m"</pre>(ksh/bash, значение в кавычках)<br><pre class="brush: bash">setenv CATALINA_OPTS "-Xms512m -Xmx512m"</pre>(tcsh/csh, значение в кавычках)<br><br>Просмотрев catalina.bat или catallina.sh, вы можете заметить что для установки JVM опций использутся CATALINA_OPTS, JAVA_OPTS или и то и другое. В чем же различие между CATALINA_OPTS и JAVA_OPTS? Имя CATALINA_OPTS специфично именно для Tomcat, а JAVA_OPTS может использоваться и в других java приложениях (например Jboss). Так как переменные окружения как правило устанавливаются глобально, Вы можете использовать это CATALINA_OPTS задания опций для Tomcat, и JAVA_OPTS - для опций других приложений.<br>Я предпочитаю использовать CATALINA_OPTS.<br><br><b>Как установить размер кучи в JBoss?</b><br><br>Остановите Jboss, отредактируйте значения в файле $JBOSS_HOME/bin/run.conf, запустите сервер. Вы можете изменить (или добавить если ее там нет) значение переменной JAVA_OPTS например на такое: <code lang="bash">JAVA_OPTS="-server -Xms128m -Xmx128m"</code><br><br><b>Как установить размер кучи в Eclipse?</b><br><br>Запускайте Eclispe с ключем "-vmargs &lt;ваши опции&gt;". Все опции после -vmargs будут интерпретированы как опции JVM.<br>Пример:<br><pre class="brush: bash">eclipse -vmargs -Xms64m -Xmx256m</pre><br>Это установит опции для Eclipse, но не для приложения которое Вы разрабатываете в eclipse. Для того чтобы поменять опции приложения, используйте Run As -&gt; Open Run Dialog -&gt; (x)=Arguments -&gt; VM Arguments<br><br><b>Как установить размер кучи в NetBeans?</b><br><br>Закройте NetBeans, отредактируйте файл netbeans-install/etc/netbeans.conf. Пример:<br><pre class="brush: bash">netbeans_default_options="-J-Xms512m -J-Xmx512m -J-XX:PermSize=32m -J-XX:MaxPermSize=128m -J-Xverify:none</pre><br><b>Как установить размер кучи в Apache Ant?</b><br><br>Установите переменную окружения ANT_OPTS. Примеры:<br><pre class="brush: bash">set ANT_OPTS=-Xms512m -Xmx512m</pre>(Windows)<br><pre class="brush: bash">export ANT_OPTS="-Xms512m -Xmx512m"</pre>(ksh/bash)<br><pre class="brush: bash">setenv ANT_OPTS "-Xms512m -Xmx512m"</pre>(tcsh/csh)<br><br><b>Как установить размер кучи в JavaEE SDK/J2EE SDK/Glassfish/Sun Java System Application Server?</b><br><br>Остановите сервер приложений, откройте $GLASSFISH_HOME/domains/domain1/config/domain.xml, найдите там XML элемент с именем java-config -&gt; jvm-options. Пример:<br><pre class="brush: xml"><br>  -Xmx512m<br>  -XX:NewRatio=2<br>  -XX:MaxPermSize=128m<br>  ...<br><br></pre><br>Также вы можете изменять опции через веб-интерфейс администратора, обычно http://localhost:4848/, или https://localhost:4848/. Откройте Application Server в верхней части левой панели, затем на правой панели откройте JVM Settings -&gt; JVM Options, и Вы увидите список текущих опций. Вы можете добавить новые или изменить существующие.<br><br>Еще один способ - использование cli комманды. Смотрите справку:<br><pre class="brush: bash">./asadmin help create-jvm-options<br>./asadmin help delete-jvm-options<br></pre></div></body></html>